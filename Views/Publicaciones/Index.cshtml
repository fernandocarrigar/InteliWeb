@using InteliWeb2.Models.ViewModels
@model List<Publicacione>

<a asp-controller="Sesion" asp-action="Close" class="btn btn-flotante btn-sm bg-success">Cerrar Sesion</a>

<section style="background-color: #eee;">
    <div class="container d-block div-ttl">
        <h1 class="align-center">Publicaciones</h1>
    </div>
    <div class="container">
        <div class="row">
            <div class="col">
                <nav aria-label="breadcrumb" class="bg-light rounded-3 p-3 mb-4">
                    <ol class="breadcrumb mb-0">
                        @if ((ViewBag.r == 2) || (ViewBag.r == 1))
                        {
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm dropdown-toggle" id="accionesDropdown" data-bs-toggle="dropdown">Usuarios</button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" asp-controller="Home" asp-action="Index" asp-route-i="@ViewBag.i">Home</a></li>
                                    <li><a class="dropdown-item" asp-controller="Usuario" asp-action="Index" asp-route-i="@ViewBag.i" asp-route-r="@ViewBag.r">Usuarios</a></li>
                                    <li><a class="dropdown-item" asp-controller="Contactos" asp-action="Index" asp-route-i="@ViewBag.i" asp-route-r="@ViewBag.r">Contactos</a></li>
                                    <li><a class="dropdown-item" asp-controller="RolUsuarios" asp-action="Index" asp-route-i="@ViewBag.i" asp-route-r="@ViewBag.r">Roles de usuario</a></li>
                                </ul>
                            </div>
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm dropdown-toggle" id="accionesDropdown" data-bs-toggle="dropdown">Servicios</button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" asp-controller="Servicios" asp-action="Index" asp-route-i="@ViewBag.i" asp-route-r="@ViewBag.r">Servicios</a></li>
                                    <li><a class="dropdown-item" asp-controller="TipoServicios" asp-action="Index" asp-route-i="@ViewBag.i" asp-route-r="@ViewBag.r">Tipo de servicios</a></li>
                                </ul>
                            </div>
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm dropdown-toggle" id="accionesDropdown" data-bs-toggle="dropdown">Publicaciones y Archivos</button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" asp-controller="Archivo" asp-action="Index" asp-route-i="@ViewBag.i" asp-route-r="@ViewBag.r">Todos los Archivos</a></li>
                                    <li><a class="dropdown-item" asp-controller="TipoArchivos" asp-action="Index" asp-route-i="@ViewBag.i" asp-route-r="@ViewBag.r">Tipo de archivos</a></li>
                                    <li><a class="dropdown-item" asp-controller="Publicaciones" asp-action="Index" asp-route-i="@ViewBag.i" asp-route-r="@ViewBag.r">Todas las Publicaciones</a></li>
                                    <li><a class="dropdown-item" asp-controller="SeccionPublicaciones" asp-action="Index" asp-route-i="@ViewBag.i" asp-route-r="@ViewBag.r">Secciones de Publicaciones</a></li>
                                    <li><a class="dropdown-item" asp-controller="TipoPublicaciones" asp-action="Index" asp-route-i="@ViewBag.i" asp-route-r="@ViewBag.r">Tipos de Publicaciones</a></li>
                                </ul>
                            </div>
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm dropdown-toggle" id="accionesDropdown" data-bs-toggle="dropdown">Contrataciones</button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" asp-controller="Contrataciones" asp-action="Index" asp-route-i="@ViewBag.i" asp-route-r="@ViewBag.r">Todas las Contrataciones</a></li>
                                    <li><a class="dropdown-item" asp-controller="EstadoContrataciones" asp-action="Index" asp-route-i="@ViewBag.i" asp-route-r="@ViewBag.r">Estados de contratacion</a></li>
                                </ul>
                            </div>
                            <li><a class="btn btn-sm" asp-controller="Sesion" asp-action="Index" asp-route-i="@ViewBag.i" asp-route-r="@ViewBag.r">Perfil</a></li>
                        }
                    </ol>
                </nav>
            </div>
        </div>
    </div>

    <div class="container table-responsive">
        <div class="row">
            <div class="col-3">
                <span><a type="button" class="btn btn-primary mt-2 btn-sm" asp-action="Create" asp-route-Id="@ViewContext.RouteData.Values["Id"]" asp-route-r="@ViewBag.r" asp-route-i="@ViewBag.i">Agregar Nueva Publicacion</a></span></p>
            </div>
            <form asp-action="Index" asp-route-r="@ViewBag.r" asp-route-i="@ViewBag.i">
                <div class="col-4 input-group input-group-sm mb-3">
                    <div class="col-7 input-group input-group-sm mb-3">
                        <select name="seccion" class="form-group form-control form-select mb-3" asp-items="ViewBag.Seccion" aria-describedby="btn-fil">
                            <option value="#" disabled selected hidden>Selecciona una Seccion</option>
                        </select>
                        <select name="tppub" class="form-group form-control form-select mb-3" asp-items="ViewBag.TipoPub" aria-describedby="btn-fil">
                            <option value="#" disabled selected hidden>Selecciona una tipo de publicacion</option>
                        </select>
                        <select name="user" class="form-group form-control form-select mb-3" asp-items="ViewBag.Usuario" aria-describedby="btn-fil">
                            <option value="#" disabled selected hidden>Selecciona un usuario a cargo</option>
                        </select>
                    </div>
                    <div class="col-2 input-group input-group-sm mb-3">
                        <select name="servicio" class="form-group form-control form-select mb-3" asp-items="ViewBag.Servicio" aria-describedby="btn-fil">
                            <option value="#" disabled selected hidden>Selecciona un servicio</option>
                        </select>
                        <select name="archivo" class="form-group form-control form-select mb-3" asp-items="ViewBag.Archivo" aria-describedby="btn-fil">
                            <option value="#" disabled selected hidden>Selecciona una tipo de servicio</option>
                        </select>
                        <div class="input-group-append">
                            <button id="btn-fil" type="submit" class="btn btn-outline-primary btn-sm">Filtrar</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="container table-responsive">
        <table class="table table-striped table-hover table-bordered table-sm">
            <thead class="table-dark">
                <tr>
                    <th class="text text-center align-middle">Id de Publicación</th>
                    <th class="text text-center align-middle">Fecha de Publicación</th>
                    <th class="text text-center align-middle">Texto Publicado</th>
                    <th class="text text-center align-middle">Archivo Publicado</th>
                    <th class="text text-center align-middle">Tipo de Publicacion</th>
                    <th class="text text-center align-middle">Seccion de la Publicacion</th>
                    <th class="text text-center align-middle">Usuario que Publico</th>
                    <th class="text text-center align-middle">Servicio Publicado</th>
                    <th class="text text-center align-middle">Actualizar</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var publicac in Model)
                {
                    <tr>
                        <td class="text text-center align-middle">@Html.DisplayFor(p=>publicac.IdPublicacion)</td>
                        <td class="text text-center align-middle">@Html.DisplayFor(p=>publicac.FechaPublicacion)</td>
                        <td class="text text-center align-middle">@Html.DisplayFor(p=>publicac.TextoPublicado)</td>

                        @{
                                var type = publicac.IdArchivoNavigation.MimeArchivo;
                                var base64 = Convert.ToBase64String(publicac.IdArchivoNavigation.ContenidoArchivo);
                                var URL = string.Format("data:{0};base64,{1}", type, base64);

                            <td class="text text-center align-middle"><iframe src="@URL" class="img-thumbnail" style="max-width:300px;max-height:200px;"></iframe></td>
                        }
                    
                        <td class="text text-center align-middle">@Html.DisplayFor(p=>publicac.IdTipoPublicacionNavigation.TipoPublicacion)</td>
                        <td class="text text-center align-middle">@Html.DisplayFor(p=>publicac.IdSeccionPublicacionNavigation.SeccionPublicacion)</td>
                        <td class="text text-center align-middle"><a asp-controller="Usuarios" asp-action="Index" asp-route-id="@publicac.IdUsuario">@Html.DisplayFor(p=>publicac.IdUsuarioNavigation.NombreUsuario)</a></td>
                        <td class="text text-center align-middle">@Html.DisplayFor(p=>publicac.IdServicioNavigation.NombreServicio)</td>
                        <td class="text text-center align-middle"><a asp-action="Update" asp-route-r="@ViewBag.r" asp-route-i="@ViewBag.i" asp-route-Id="@publicac.IdPublicacion" type="button" class="btn btn-primary btn-sm">Actualizar</a></td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</section>

<script type="text/javascript">
    window.history.forward();
</script>